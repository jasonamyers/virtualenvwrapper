[tox]
envlist = py,zsh,style

[testenv]
install_command = pip install -U {opts} {packages}
commands = bash ./tests/run_tests {envdir} []
deps = -rrequirements.txt
pass_env =
    HOME
    USER
setenv =
    TOXIC = true
    SHELL = /bin/bash
allowlist_externals =
    bash
    zsh
    ksh

[testenv:fast]
setenv =
    TOXIC = true
    SHELL = /bin/bash
    FAIL_FAST = true

[testenv:style]
deps = flake8
commands = flake8 virtualenvwrapper docs/source/conf.py

[testenv:zsh]
setenv =
  SHELL = /bin/zsh
  test_shell_opts = -o shwordsplit
commands =  zsh -o shwordsplit ./tests/run_tests {envdir} []

[testenv:ksh]
basepython=python2.7
setenv =
  SHELL = /bin/ksh
commands =  ksh ./tests/run_tests {envdir} []

[testenv:docs]
deps =
  -r{toxinidir}/requirements.txt
  -r{toxinidir}/docs/requirements.txt
commands = python setup.py build_sphinx

[testenv:pkglint]
deps=
    pbr
    twine
    check-python-versions
commands=
    python setup.py sdist
    twine check dist/*.tar.gz
    check-python-versions --only setup.py,setup.cfg,.github/workflows/test.yml
